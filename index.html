
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>نظام الفواتير الجزائري الاحترافي</title>
    
    <!-- Scripts for Browser Compatibility -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Cairo:wght@200..1000&family=Reem+Kufi:wght@400..700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f1f5f9;
            color: #1e293b;
            margin: 0;
            padding: 0;
        }
        .font-amiri { font-family: 'Amiri', serif; }
        .font-reem { font-family: 'Reem Kufi', sans-serif; }
        
        /* إعدادات الطباعة الدقيقة A4 */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }
            body {
                background-color: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            .no-print {
                display: none !important;
            }
            .print-container {
                width: 100% !important;
                margin: 0 !important;
                padding: 0 !important;
                display: block !important;
            }
            /* تحديد أبعاد الورقة بدقة 210mm x 297mm */
            .invoice-page {
                width: 210mm !important;
                height: 297mm !important;
                padding: 15mm !important;
                margin: 0 auto !important;
                page-break-after: always !important;
                border: none !important;
                box-shadow: none !important;
                display: flex !important;
                flex-direction: column !important;
                position: relative !important;
                overflow: hidden !important;
            }
            /* إزالة إطارات الزينة عند الطباعة لضمان المساحة */
            .border-print-fix {
                border: none !important;
            }
        }

        /* تنسيق شريط التمرير */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #db2777; border-radius: 4px; }

        /* تنسيق المعاينة على الشاشة */
        .invoice-page {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Plus, Trash2, Printer, FileText, RotateCcw, 
            Users, Archive, Save, Building2, Truck 
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- Utils ---
        const convertAmountToWords = (amount) => {
            return `هذه الفاتورة محددة بمبلغ إجمالي قدره: ${amount.toLocaleString('ar-DZ')} دينار جزائري فقط لا غير.`;
        };

        // --- Component: Invoice Preview ---
        const InvoicePreview = ({ data }) => {
            const subtotal = data.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tvaAmount = subtotal * (data.tvaRate / 100);
            const timbre = data.paymentMethod === 'CASH' ? Math.min(Math.max((subtotal + tvaAmount) * 0.01, 5), 10000) : 0;
            const total = subtotal + tvaAmount + timbre;

            const formatDate = (dateStr) => {
                try { return new Date(dateStr).toLocaleDateString('ar-DZ', { year: 'numeric', month: 'long', day: 'numeric' }); }
                catch { return dateStr; }
            };

            return (
                <div className="invoice-page bg-white p-12 min-h-[1120px] relative flex flex-col font-cairo text-gray-800 border-[12px] border-pink-50 border-print-fix">
                    {/* الترويسة */}
                    <div className="mb-8 border-b-2 border-gray-100 pb-6 text-center">
                        <h1 className="text-4xl font-reem text-gray-900 mb-2 leading-relaxed">{data.company.name}</h1>
                        <p className="text-[13px] text-gray-600 font-amiri italic mb-4">{data.company.address} | هاتف: {data.company.phone}</p>
                        
                        <div className="flex justify-between items-end">
                            <div dir="ltr" className="grid grid-cols-2 gap-x-6 gap-y-0.5 text-[10px] text-gray-500 font-mono border-r-4 border-pink-600 pr-4 text-left">
                                <div><strong>RC:</strong> {data.company.rc}</div>
                                <div><strong>NIF:</strong> {data.company.nif}</div>
                                <div><strong>NIS:</strong> {data.company.nis}</div>
                                <div><strong>AI:</strong> {data.company.ai}</div>
                            </div>
                            <div className="text-left">
                                <div className="bg-gray-900 text-white px-10 py-4 rounded-bl-[40px] shadow-xl transform -translate-x-4">
                                    <h2 className="text-2xl font-bold font-reem text-center">فـاتـورة</h2>
                                    <p className="text-[11px] opacity-70 mt-1 font-mono tracking-widest text-center">N°: {data.invoiceNumber}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* بيانات الزبون */}
                    <div className="grid grid-cols-2 gap-8 mb-8 bg-gray-50/50 p-6 rounded-3xl border border-gray-100">
                        <div className="space-y-1 border-r-2 border-pink-100 pr-4">
                            <h4 className="text-[10px] font-bold text-pink-500 uppercase mb-1">بيانات الزبون:</h4>
                            <h3 className="text-xl font-bold font-amiri text-gray-900 leading-tight">{data.client.name}</h3>
                            <p className="text-[14px] text-gray-600 font-amiri">{data.client.address}</p>
                            <p className="text-[12px] text-gray-500 mt-1">الهاتف: {data.client.phone}</p>
                        </div>
                        <div className="text-left flex flex-col items-end justify-center space-y-3">
                            <div className="text-[12px] flex gap-2">
                                <span className="text-gray-400 font-bold">تاريخ الفاتورة:</span>
                                <span className="font-bold text-gray-800">{formatDate(data.date)}</span>
                            </div>
                            <div className="text-[12px] flex gap-2">
                                <span className="text-gray-400 font-bold">تاريخ الاستحقاق:</span>
                                <span className="font-bold text-gray-800">{formatDate(data.dueDate)}</span>
                            </div>
                            <div className="mt-2">
                                <span className="bg-pink-600 text-white px-5 py-1.5 rounded-full text-[11px] font-bold shadow-sm">
                                    {data.paymentMethod === 'TRANSFER' ? 'تحويل بنكي' : data.paymentMethod === 'CHECK' ? 'صك بريدي' : 'نقداً'}
                                </span>
                            </div>
                        </div>
                    </div>

                    {/* جدول السلع */}
                    <div className="flex-grow">
                        <table className="w-full text-right table-fixed border-collapse">
                            <thead>
                                <tr className="bg-gray-900 text-white">
                                    <th className="p-3 text-[11px] font-reem w-12 text-center border-l border-gray-700">#</th>
                                    <th className="p-3 text-[11px] font-reem text-right border-l border-gray-700">الوصف والبيان</th>
                                    <th className="p-3 text-[11px] font-reem w-20 text-center border-l border-gray-700">الكمية</th>
                                    <th className="p-3 text-[11px] font-reem w-32 text-center border-l border-gray-700">سعر الوحدة</th>
                                    <th className="p-3 text-[11px] font-reem w-36 text-left">المبلغ الصافي</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100 border-x border-b border-gray-100">
                                {data.items.map((item, idx) => (
                                    <tr key={item.id}>
                                        <td className="px-1 py-3 text-center text-[12px] text-gray-400 font-mono border-l border-gray-50">{idx + 1}</td>
                                        <td className="px-4 py-3 font-amiri text-[17px] text-gray-800 leading-tight border-l border-gray-50">{item.description}</td>
                                        <td className="px-1 py-3 text-center text-[15px] font-bold text-gray-600 border-l border-gray-50">{item.quantity}</td>
                                        <td className="px-1 py-3 text-center text-[15px] text-gray-600 border-l border-gray-50">{item.price.toLocaleString('ar-DZ')}</td>
                                        <td className="px-4 py-3 text-left text-[16px] font-bold text-gray-900">{(item.price * item.quantity).toLocaleString('ar-DZ')}</td>
                                    </tr>
                                ))}
                                {/* صفوف فارغة للحفاظ على شكل الفاتورة */}
                                {data.items.length < 8 && [...Array(8 - data.items.length)].map((_, i) => (
                                    <tr key={`filler-${i}`} className="h-10">
                                        <td colSpan={5}></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* المجموع والتوقيع */}
                    <div className="mt-8 flex justify-between items-start gap-12">
                        <div className="w-3/5">
                            <div className="bg-pink-50/50 p-5 rounded-2xl border border-pink-100 shadow-inner mb-4">
                                <h4 className="text-[10px] font-bold text-pink-600 mb-2 tracking-widest uppercase">المبلغ الإجمالي بالحروف:</h4>
                                <p className="text-[15px] font-amiri font-bold text-gray-800 italic leading-snug">
                                    {convertAmountToWords(total)}
                                </p>
                            </div>
                            <div className="text-[11px] text-gray-400 font-amiri italic leading-tight">
                                <strong>ملاحظات وشروط:</strong> {data.notes}
                            </div>
                        </div>

                        <div className="w-1/3 bg-gray-50 rounded-3xl p-5 space-y-3 border border-gray-100">
                            <div className="flex justify-between items-center text-[12px]">
                                <span className="text-gray-500 font-bold">المجموع خارج الرسم:</span>
                                <span className="font-bold text-gray-800">{subtotal.toLocaleString('ar-DZ')} دج</span>
                            </div>
                            <div className="flex justify-between items-center text-[12px]">
                                <span className="text-gray-500 font-bold">الرسم (TVA {data.tvaRate}%):</span>
                                <span className="font-bold text-gray-800">{tvaAmount.toLocaleString('ar-DZ')} دج</span>
                            </div>
                            {timbre > 0 && (
                                <div className="flex justify-between items-center text-[12px] text-pink-600 border-t border-dashed pt-2">
                                    <span className="font-bold">حق الطابع (Timbre):</span>
                                    <span className="font-bold">{timbre.toLocaleString('ar-DZ')} دج</span>
                                </div>
                            )}
                            <div className="h-px bg-gray-300 my-1"></div>
                            <div className="flex justify-between items-center">
                                <span className="text-xl font-reem font-bold text-gray-900">الصافي للدفع:</span>
                                <span className="text-2xl font-bold text-pink-600">{total.toLocaleString('ar-DZ')} دج</span>
                            </div>
                        </div>
                    </div>

                    {/* قسم التوقيع والختم - تمت إعادته */}
                    <div className="mt-12 flex justify-end">
                        <div className="text-center relative pr-20">
                            <p className="text-[11px] font-bold text-gray-400 mb-24 uppercase tracking-[0.2em]">إمضاء وختم المؤسسة</p>
                            <div className="w-64 h-px bg-gray-200 mx-auto"></div>
                            <p className="mt-4 font-bold text-gray-900 uppercase text-[10px] tracking-widest">{data.company.name}</p>
                            
                            {/* زخرفة الختم */}
                            <div className="absolute top-2 -left-12 w-32 h-32 border-2 border-pink-100 rounded-full flex items-center justify-center opacity-10 rotate-12 pointer-events-none">
                                <p className="text-[10px] text-pink-600 font-bold text-center leading-none uppercase">ORIGINAL<br/>DOCUMENT<br/>VALIDATED</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Component: Delivery Note Preview ---
        const DeliveryNotePreview = ({ data }) => {
            const formatDate = (dateStr) => {
                try { return new Date(dateStr).toLocaleDateString('ar-DZ', { year: 'numeric', month: 'long', day: 'numeric' }); }
                catch { return dateStr; }
            };

            return (
                <div className="invoice-page bg-white p-12 min-h-[1120px] relative flex flex-col font-cairo text-gray-800 border-[12px] border-blue-50 border-print-fix">
                    <div className="mb-8 border-b-2 border-gray-100 pb-6 text-center">
                        <h1 className="text-4xl font-reem text-gray-900 mb-2 leading-relaxed">{data.company.name}</h1>
                        <p className="text-[13px] text-gray-600 font-amiri italic mb-4">{data.company.address} | هاتف: {data.company.phone}</p>
                        
                        <div className="flex justify-between items-end">
                            <div dir="ltr" className="grid grid-cols-2 gap-x-6 gap-y-0.5 text-[10px] text-gray-500 font-mono border-r-4 border-blue-600 pr-4 text-left">
                                <div><strong>RC:</strong> {data.company.rc}</div>
                                <div><strong>NIF:</strong> {data.company.nif}</div>
                                <div><strong>NIS:</strong> {data.company.nis}</div>
                                <div><strong>AI:</strong> {data.company.ai}</div>
                            </div>
                            <div className="text-left">
                                <div className="bg-blue-900 text-white px-10 py-4 rounded-bl-[40px] shadow-xl transform -translate-x-4">
                                    <h2 className="text-2xl font-bold font-reem text-center">سند تسليم</h2>
                                    <p className="text-[11px] opacity-70 mt-1 font-mono tracking-widest text-center">N°: {data.invoiceNumber}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-8 mb-8 bg-blue-50/30 p-6 rounded-3xl border border-blue-100">
                        <div className="space-y-1 border-r-2 border-blue-200 pr-4">
                            <h4 className="text-[10px] font-bold text-blue-500 uppercase mb-1">المرسل إليه:</h4>
                            <h3 className="text-xl font-bold font-amiri text-gray-900 leading-tight">{data.client.name}</h3>
                            <p className="text-[14px] text-gray-600 font-amiri">{data.client.address}</p>
                        </div>
                        <div className="text-left flex flex-col items-end justify-center">
                            <div className="text-[12px] flex gap-2">
                                <span className="text-gray-400 font-bold">تاريخ التسليم:</span>
                                <span className="font-bold text-gray-800">{formatDate(data.date)}</span>
                            </div>
                            <div className="mt-4 px-6 py-2 border border-blue-200 bg-white rounded-xl text-[11px] text-blue-600 font-bold uppercase italic tracking-wider shadow-sm">
                                BORDEREAU DE LIVRAISON
                            </div>
                        </div>
                    </div>

                    <div className="flex-grow">
                        <table className="w-full text-right table-fixed border-collapse">
                            <thead>
                                <tr className="bg-blue-900 text-white">
                                    <th className="p-3 text-[11px] font-reem w-14 text-center border-l border-blue-700">#</th>
                                    <th className="p-3 text-[11px] font-reem text-right border-l border-blue-700">تعيين السلعة / الخدمة</th>
                                    <th className="p-3 text-[11px] font-reem w-40 text-center">الكمية المسلمة</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-100 border-x border-b border-gray-100">
                                {data.items.map((item, idx) => (
                                    <tr key={item.id}>
                                        <td className="px-1 py-4 text-center text-[12px] text-gray-400 font-mono border-l border-gray-50">{idx + 1}</td>
                                        <td className="px-5 py-4 font-amiri text-[19px] text-gray-800 border-l border-gray-50 leading-snug">{item.description}</td>
                                        <td className="px-1 py-4 text-center text-[18px] font-bold text-gray-900">{item.quantity}</td>
                                    </tr>
                                ))}
                                {data.items.length < 10 && [...Array(10 - data.items.length)].map((_, i) => (
                                    <tr key={`filler-${i}`} className="h-12 border-none">
                                        <td colSpan={3}></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <div className="mt-16 grid grid-cols-2 gap-32">
                        <div className="text-center">
                            <p className="text-[11px] font-bold text-gray-400 mb-28 uppercase tracking-[0.2em]">إمضاء المستلم</p>
                            <div className="w-64 h-px bg-gray-200 mx-auto"></div>
                            <p className="mt-4 text-[10px] text-gray-400 italic font-amiri">(الاسم واللقب وتاريخ الاستلام)</p>
                        </div>
                        <div className="text-center relative">
                            <p className="text-[11px] font-bold text-gray-400 mb-28 uppercase tracking-[0.2em]">ختم وإمضاء المؤسسة</p>
                            <div className="w-64 h-px bg-gray-200 mx-auto"></div>
                            <div className="absolute top-2 right-1/4 w-32 h-32 border-2 border-blue-100 rounded-full flex items-center justify-center opacity-10 rotate-12 pointer-events-none">
                                <p className="text-[10px] text-blue-600 font-bold text-center leading-none uppercase">LIVRAISON<br/>CONFORME</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('editor');
            const [company, setCompany] = useState(() => JSON.parse(localStorage.getItem('dz_comp_v3') || '{"name":"مؤسسة الابتكار للخدمات الرقمية","address":"حي 1200 مسكن، الدار البيضاء، الجزائر","phone":"+213 23 45 67 89","rc":"16/00-9876543B21","nif":"001916012345678","nis":"192016001234567","ai":"16011234567","bankName":"CPA Bank","bankAccount":"004 00123 4123456789 22"}'));
            const [clients, setClients] = useState(() => JSON.parse(localStorage.getItem('dz_clients_v3') || '[]'));
            const [archive, setArchive] = useState(() => JSON.parse(localStorage.getItem('dz_archive_v3') || '[]'));
            
            const createNew = (c) => ({
                id: Math.random().toString(36).substr(2, 9),
                invoiceNumber: `${new Date().getFullYear()}/${Math.floor(Math.random()*900)+100}`,
                date: new Date().toISOString().split('T')[0],
                dueDate: new Date(Date.now()+2592000000).toISOString().split('T')[0],
                company: c,
                client: { name: "", address: "", phone: "" },
                items: [{ id: '1', description: '', price: 0, quantity: 1 }],
                tvaRate: 19,
                paymentMethod: 'TRANSFER',
                notes: "تعتبر هذه الفاتورة بمثابة عقد بيع بين الطرفين وقبول السلعة يعني الموافقة التامة."
            });

            const [data, setData] = useState(() => createNew(company));

            useEffect(() => { localStorage.setItem('dz_comp_v3', JSON.stringify(company)); setData(prev => ({...prev, company})); }, [company]);
            useEffect(() => localStorage.setItem('dz_clients_v3', JSON.stringify(clients)), [clients]);
            useEffect(() => localStorage.setItem('dz_archive_v3', JSON.stringify(archive)), [archive]);

            const handleSave = () => {
                const sub = data.items.reduce((s,i)=>s+(i.price*i.quantity),0);
                const tva = sub * (data.tvaRate/100);
                const tim = data.paymentMethod==='CASH'?Math.min(Math.max((sub+tva)*0.01,5),10000):0;
                setArchive([{...data, total: sub+tva+tim}, ...archive]);
                alert("تم حفظ الفاتورة بنجاح!");
            };

            const Input = ({ label, value, onChange, type="text", className="" }) => (
                <div className={className}>
                    <label className="text-[10px] font-bold text-gray-400 block mb-1 uppercase tracking-widest">{label}</label>
                    <input type={type} className="w-full px-4 py-2.5 bg-white border border-gray-200 rounded-xl text-sm font-semibold focus:ring-4 focus:ring-pink-50 outline-none transition-all shadow-sm" value={value} onChange={e => onChange(e.target.value)} />
                </div>
            );

            return (
                <div className="min-h-screen">
                    <header className="no-print bg-white/90 backdrop-blur-md border-b shadow-sm sticky top-0 z-50 px-6 py-3 flex flex-col lg:flex-row justify-between items-center gap-4">
                        <div className="flex items-center gap-4">
                            <div className="bg-pink-600 p-2.5 rounded-xl text-white shadow-lg rotate-3"><FileText size={24}/></div>
                            <div>
                                <h1 className="text-xl font-bold font-reem text-gray-800 leading-none">نظام الفواتير الجزائري</h1>
                                <p className="text-[10px] text-pink-500 font-bold mt-1 uppercase tracking-widest">Master Billing Pro</p>
                            </div>
                        </div>
                        <nav className="flex bg-gray-100 p-1.5 rounded-2xl">
                            {['settings', 'clients', 'editor', 'archive'].map(tab => (
                                <button key={tab} onClick={() => setActiveTab(tab)} className={`px-6 py-2.5 rounded-[15px] text-[13px] font-bold transition-all ${activeTab === tab ? 'bg-white text-pink-600 shadow-md' : 'text-gray-500 hover:text-gray-800'}`}>
                                    {tab === 'settings' ? 'المؤسسة' : tab === 'clients' ? 'العملاء' : tab === 'editor' ? 'إنشاء فاتورة' : 'الأرشيف'}
                                </button>
                            ))}
                        </nav>
                        <div className="flex gap-3">
                            {activeTab === 'editor' && (
                                <><button onClick={handleSave} className="bg-green-600 text-white px-6 py-2.5 rounded-2xl text-[13px] font-bold flex items-center gap-2 shadow-lg active:scale-95 transition-all"><Save size={18}/> حفظ</button>
                                <button onClick={() => window.print()} className="bg-pink-600 text-white px-6 py-2.5 rounded-2xl text-[13px] font-bold flex items-center gap-2 shadow-lg active:scale-95 transition-all"><Printer size={18}/> طباعة</button></>
                            )}
                        </div>
                    </header>

                    <main className="max-w-[1500px] mx-auto mt-10 px-6 pb-20">
                        {activeTab === 'editor' && (
                            <div className="grid grid-cols-1 xl:grid-cols-5 gap-10 items-start">
                                <div className="no-print xl:col-span-2 space-y-6">
                                    <div className="bg-white p-8 rounded-[30px] border shadow-sm">
                                        <h2 className="text-lg font-bold mb-6 flex items-center gap-2 text-gray-800">بيانات الفاتورة والزبون</h2>
                                        <div className="grid grid-cols-2 gap-5">
                                            <Input label="رقم الفاتورة" value={data.invoiceNumber} onChange={v=>setData({...data, invoiceNumber:v})} />
                                            <Input label="التاريخ" type="date" value={data.date} onChange={v=>setData({...data, date:v})} />
                                            <Input label="اسم الزبون" value={data.client.name} onChange={v=>setData(d=>({...d, client:{...d.client, name:v}}))} className="col-span-2" />
                                            <Input label="العنوان" value={data.client.address} onChange={v=>setData(d=>({...d, client:{...d.client, address:v}}))} className="col-span-2" />
                                            <div className="col-span-2 space-y-2">
                                                <label className="text-[10px] font-bold text-gray-400 uppercase tracking-widest">طريقة الدفع</label>
                                                <div className="flex gap-2">
                                                    {['TRANSFER', 'CHECK', 'CASH'].map(m => (
                                                        <button key={m} onClick={()=>setData({...data, paymentMethod:m})} className={`flex-1 py-3 rounded-xl border text-[12px] font-bold transition-all ${data.paymentMethod === m ? 'bg-pink-600 text-white border-pink-600 shadow-md' : 'bg-gray-50 text-gray-500 hover:bg-gray-100'}`}>
                                                            {m === 'TRANSFER' ? 'تحويل' : m === 'CHECK' ? 'صك' : 'نقداً'}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="bg-white p-8 rounded-[30px] border shadow-sm">
                                        <div className="flex justify-between items-center mb-6"><h2 className="text-lg font-bold text-gray-800">السلع والخدمات</h2><button onClick={()=>setData(p=>({...p, items:[...p.items,{id:Date.now().toString(),description:'',price:0,quantity:1}]}))} className="bg-pink-50 text-pink-600 px-4 py-1.5 rounded-full text-xs font-bold shadow-sm hover:bg-pink-600 hover:text-white transition-all">+ إضافة سطر</button></div>
                                        <div className="space-y-4">
                                            {data.items.map(item => (
                                                <div key={item.id} className="grid grid-cols-12 gap-3 p-4 bg-gray-50 rounded-2xl border border-gray-100 items-end">
                                                    <div className="col-span-6"><input className="w-full p-2 border border-gray-200 rounded-lg text-sm" placeholder="وصف السلعة" value={item.description} onChange={e=>setData(d=>({...d, items:d.items.map(it=>it.id===item.id?{...it,description:e.target.value}:it)}))} /></div>
                                                    <div className="col-span-2"><input type="number" className="w-full p-2 border border-gray-200 rounded-lg text-sm text-center" value={item.quantity} onChange={e=>setData(d=>({...d, items:d.items.map(it=>it.id===item.id?{...it,quantity:parseFloat(e.target.value)||0}:it)}))} /></div>
                                                    <div className="col-span-3"><input type="number" className="w-full p-2 border border-gray-200 rounded-lg text-sm font-bold" value={item.price} onChange={e=>setData(d=>({...d, items:d.items.map(it=>it.id===item.id?{...it,price:parseFloat(e.target.value)||0}:it)}))} /></div>
                                                    <button onClick={()=>setData(d=>({...d, items:d.items.filter(it=>it.id!==item.id)}))} className="col-span-1 text-red-300 hover:text-red-500 transition-all">×</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="xl:col-span-3 sticky top-28 print-container">
                                    <div className="bg-gray-200 p-8 lg:p-12 rounded-[50px] shadow-inner border border-gray-300 flex flex-col gap-12 overflow-visible">
                                        <InvoicePreview data={data} />
                                        <DeliveryNotePreview data={data} />
                                    </div>
                                </div>
                            </div>
                        )}
                        {activeTab === 'settings' && (
                            <div className="max-w-4xl mx-auto bg-white p-12 rounded-[40px] shadow-sm border">
                                <h2 className="text-3xl font-bold font-reem mb-10 text-gray-800 border-b pb-6 flex items-center gap-4"><Building2 className="text-pink-600"/> إعدادات المؤسسة</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <Input label="اسم المؤسسة" value={company.name} onChange={v=>setCompany({...company, name:v})} />
                                    <Input label="العنوان الكامل" value={company.address} onChange={v=>setCompany({...company, address:v})} />
                                    <Input label="رقم الهاتف" value={company.phone} onChange={v=>setCompany({...company, phone:v})} />
                                    <div className="md:col-span-2 h-px bg-gray-100 my-4"></div>
                                    <Input label="السجل التجاري (RC)" value={company.rc} onChange={v=>setCompany({...company, rc:v})} />
                                    <Input label="الرقم التعريفي الضريبي (NIF)" value={company.nif} onChange={v=>setCompany({...company, nif:v})} />
                                    <Input label="رقم المادة (AI)" value={company.ai} onChange={v=>setCompany({...company, ai:v})} />
                                    <Input label="الرقم الإحصائي (NIS)" value={company.nis} onChange={v=>setCompany({...company, nis:v})} />
                                </div>
                            </div>
                        )}
                        {activeTab === 'clients' && (
                            <div className="bg-white p-10 rounded-[40px] border shadow-sm">
                                <div className="flex justify-between items-center mb-10">
                                    <h2 className="text-3xl font-bold font-reem">دليل العملاء</h2>
                                    <button onClick={()=>setClients([{id:Date.now().toString(),name:'زبون جديد',address:'',phone:''},...clients])} className="bg-pink-600 text-white px-8 py-3 rounded-2xl font-bold flex items-center gap-2 shadow-lg">+ إضافة زبون</button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    {clients.map(c => (
                                        <div key={c.id} className="bg-gray-50 p-6 rounded-3xl border border-gray-100 hover:shadow-xl transition-all">
                                            <Input label="اسم الزبون" value={c.name} onChange={v=>setClients(clients.map(cl=>cl.id===c.id?{...cl,name:v}:cl))} />
                                            <Input className="mt-4" label="العنوان" value={c.address} onChange={v=>setClients(clients.map(cl=>cl.id===c.id?{...cl,address:v}:cl))} />
                                            <button onClick={()=>{setData({...data, client:c}); setActiveTab('editor');}} className="w-full mt-6 bg-white text-pink-600 border border-pink-100 py-3 rounded-xl font-bold text-sm hover:bg-pink-600 hover:text-white transition-all">استيراد للفاتورة</button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {activeTab === 'archive' && (
                            <div className="bg-white p-10 rounded-[40px] border shadow-sm">
                                <h2 className="text-3xl font-bold font-reem mb-8">سجل العمليات</h2>
                                <div className="overflow-hidden rounded-3xl border">
                                    <table className="w-full text-right border-collapse">
                                        <thead className="bg-gray-900 text-white">
                                            <tr><th className="p-5">رقم الفاتورة</th><th className="p-5">الزبون</th><th className="p-5">التاريخ</th><th className="p-5 text-left">المبلغ</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100">
                                            {archive.map(inv => (
                                                <tr key={inv.id} className="hover:bg-pink-50/20 transition-all cursor-pointer" onClick={()=>{setData(inv); setActiveTab('editor');}}>
                                                    <td className="p-5 font-bold text-pink-600">{inv.invoiceNumber}</td>
                                                    <td className="p-5 font-bold">{inv.client.name}</td>
                                                    <td className="p-5 text-gray-500">{inv.date}</td>
                                                    <td className="p-5 font-bold text-left">{inv.total?.toLocaleString()} دج</td>
                                                </tr>
                                            ))}
                                            {archive.length === 0 && (
                                                <tr><td colSpan={4} className="p-20 text-center text-gray-300 italic">لا توجد بيانات محفوظة بعد</td></tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
